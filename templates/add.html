<!DOCTYPE html>
<html>
<head>
    <title>Add Book - BookTracker</title>
    <style>
        body {font-family:system-ui;margin:40px;background:#f9f9f9;}
        input, textarea, button {padding:10px 16px;font-size:16px;border-radius:6px;margin:5px 0;}
        label {display:inline-block;width:160px;font-weight:bold;}
        button {background:#0066cc;color:white;border:none;cursor:pointer;}
    </style>
</head>
<body>
<h1>Add a Book</h1>

<form method="post" action="/lookup">
    <h3>Search (optional)</h3>
    <p><label>Title:</label>      <input name="title" size="70" value="{{ query.title or '' }}"></p>
    <p><label>Author:</label>     <input name="author" size="70" value="{{ query.author or '' }}"></p>
    <p><label>ISBN:</label>       <input name="isbn" size="20" value="{{ query.isbn or '' }}"></p>
    <p><label>LCCN:</label>       <input name="lccn" size="20" value="{{ query.lccn or '' }}"></p>
    <button type="submit">Lookup on Google Books</button>
</form>

<hr>

<form method="post" action="/add_manual">
    <h3>Or Add Manually</h3>
    <p><label>Title:</label>      <input name="title" size="70" required value="{{ query.title or '' }}"></p>
    <p><label>Author:</label>     <input name="author" size="70" required value="{{ query.author or '' }}"></p>
    <p><label>ISBN-13:</label>    <input name="isbn13" size="20"></p>
    <p><label>ISBN-10:</label>    <input name="isbn10" size="20"></p>
    <p><label>LCCN:</label>       <input name="lccn" size="20" value="{{ query.lccn or '' }}"></p>
    <p><label>Copies:</label>     <input name="copies" type="number" min="1" value="1" required></p>
    <p><label>Cover URL:</label> <input name="cover_url" size="70" placeholder="https://example.com/cover.jpg (optional)"></p>

    <h4>Personal Info</h4>
    <p><label>Price Paid ($):</label> <input name="purchase_price" type="number" step="0.01" placeholder="24.99"></p>
    <p><label>Date Purchased:</label> <input name="date_purchased" type="date"></p>
    <p><label>Date Read:</label>      <input name="date_read" type="date"></p>
    <p><label>Comment:</label><br>
       <textarea name="comment" rows="3" placeholder="Signed copy, gift from Mom, etc."></textarea></p>

    <button type="submit">Save Book (Manual)</button>
    <a href="/">Cancel</a>
</form>
<script>
    document.querySelector("form[action='/lookup']").addEventListener("submit", function(e) {
        const isbn = this.querySelector("input[name='isbn']").value;
        if (isbn.trim() === '') return;  // Skip if empty

        const clean = isbn.replace(/[^0-9X]/gi, '');  // Clean in JS too
        const isValid10 = /^[0-9]{9}[0-9X]$/.test(clean);
        const isValid13 = /^[0-9]{13}$/.test(clean);

        if (!isValid10 && !isValid13) {
            e.preventDefault();
            alert("Invalid ISBN â€” it should be 10 digits (with optional X at end) or 13 digits. Please check and try again.");
        }
    });
</script>
</body>
</html>
